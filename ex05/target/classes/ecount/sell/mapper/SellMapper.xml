<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ecount.sell.mapper.SellMapper">

	<!-- 전체 데이터 가져오기 -->
	<select id="getList" resultType="ecount.sell.domain.SellVO">
		select * from sell order by created_at desc
	</select>
	

	<!-- 판매입력 부분 -->
	<insert id="insertSell">
		insert into sell(acc_uuid, acc_num,clientnum, managernum, storageid, projectnum, saletype, type, status, created_at, modified_at, deleted_at)
    			values(#{acc_uuid}, #{acc_num}, #{clientnum}, #{managernum}, #{storageid}, #{projectnum}, #{saletype}, #{type}, #{status}, #{created_at}, 
    					#{modified_at}, #{deleted_at})
	</insert>
	
	<!-- 판매번호와 품목목번호 저장 -->
	<insert id="insertMappingTable">
			insert into mappingtable(uuid, productnum)values(#{uuid}, #{productnum})
	</insert>
	
	<!-- 품목목록과 품목 연결테이블 데이터 저장 -->
	<insert id="insertProductMapping">
			insert into product_mapping(productnum,productcode) values(#{productnum},#{productcode})
	</insert>
	

	<select id="getListWithPaging"
			resultType="ecount.sell.domain.SellVO">
		<![CDATA[
			select *
			from
    			(
       				select /*+INDEX_DESC(sell pk_sell) */
            			rownum rn, s.acc_uuid, s.acc_num, 
						c.name as clientname, m.name as managername, ss.storagename as storagename, p.name as projectname, 
						s.salestype, s.type, s.status, s.created_at, s.modified_at, s.deleted_at
					from
            			sell s
        			join client c on c.clientnum = s.clientnum
        			join manager m on m.managernum = s.managernum
        			join shippingstorage ss on ss.storageid = s.storageid
        			join project p on p.projectnum = s.projectnum
					where
						rownum <= #{pageNum} * #{amount}
				)
			where rn > (#{pageNum} - 1) * #{amount}
			]]>
	</select>
	
	
	
	<select id="getTotalCount" resultType="int">
		select count(*) from sell
	</select>


	
	
</mapper>